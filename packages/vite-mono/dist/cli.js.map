{"version":3,"file":"cli.js","sources":["../src/logger.ts","../src/require.ts","../src/package.ts","../src/index.ts","../src/cli.ts"],"sourcesContent":["import { format as sprintf } from 'node:util';\nimport chalk from 'chalk';\n\nconst logFormats = {\n\tinfo: chalk.blue('[INFO]:') + ' ' + '%s',\n\twarn: chalk.yellowBright.bgYellow('[WARN]:') + ' ' + chalk.yellow('%s'),\n\terror: chalk.redBright.bgRed('[ERROR]') + ' ' + chalk.red('%s'),\n\tfatal: chalk.redBright.bgRed('FATAL') + ' ' + chalk.red('%s'),\n};\n\ntype LogLevel = keyof typeof logFormats;\n\nclass Logger {\n\thasOnceWarnLogged: boolean;\n\thasOnceErrorLogged: boolean;\n\twarnOnceCache: Set<string>;\n\n\tconstructor() {\n\t\tthis.warnOnceCache = new Set<string>();\n\t\tthis.hasOnceWarnLogged = false;\n\t\tthis.hasOnceErrorLogged = false;\n\t}\n\n\thasWarned() {\n\t\treturn this.hasOnceWarnLogged;\n\t}\n\n\thasErrorLogged() {\n\t\treturn this.hasOnceErrorLogged;\n\t}\n\n\tformat(format: string, ...params: string[]) {\n\t\treturn sprintf(format, ...params);\n\t}\n\n\tlog(message: string, logLevel: LogLevel = 'info') {\n\t\tconsole.log(this.format(logFormats[logLevel], message));\n\t}\n\n\tinfo(...args: Parameters<typeof this.log>) {\n\t\tthis.log(...args);\n\t}\n\n\twarn(message: string, logLevel: LogLevel = 'warn') {\n\t\tif (!this.hasOnceWarnLogged) {\n\t\t\tthis.hasOnceWarnLogged = true;\n\t\t}\n\n\t\tconsole.warn(this.format(logFormats[logLevel], message));\n\t}\n\n\twarnOnce(message: string, logLevel: LogLevel = 'warn') {\n\t\tif (this.warnOnceCache.has(message + logLevel)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.warn(message, logLevel);\n\t\tthis.warnOnceCache.add(message + logLevel);\n\t}\n\n\terror(message: string, logLevel: LogLevel = 'error') {\n\t\tif (!this.hasOnceErrorLogged) {\n\t\t\tthis.hasOnceErrorLogged = true;\n\t\t}\n\n\t\tconsole.error(this.format(logFormats[logLevel], message));\n\t}\n\n\tclearScreen() {\n\t\tconsole.clear();\n\t}\n}\n\nexport default Logger;\n","import { createRequire } from 'module';\nimport { fileURLToPath } from 'url';\n\nconst require = createRequire(fileURLToPath(import.meta.url));\n\nexport default require;\n","import path from 'node:path';\nimport fs from 'node:fs';\nimport { z } from 'zod';\nimport require from './require';\nimport { isBuiltin } from 'node:module';\nimport semverValid from 'semver/functions/valid';\n\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\ninterface JSONSchema extends z.ZodType<JSONValue> {}\n\ntype JSONValue = string | number | boolean | null | { [key: string]: JSONValue } | JSONValue[];\n\nexport const JSONSchema: JSONSchema = z.lazy(() =>\n\tz.union([\n\t\tz.string(),\n\t\tz.number(),\n\t\tz.boolean(),\n\t\tz.null(),\n\t\tz.record(z.string(), JSONSchema),\n\t\tz.array(JSONSchema),\n\t]),\n);\n\nconst json: () => JSONSchema = () =>\n\tz.union([\n\t\tz.string(),\n\t\tz.number(),\n\t\tz.boolean(),\n\t\tz.null(),\n\t\tz.record(\n\t\t\tz.string(),\n\t\t\tz.lazy(() => json()),\n\t\t),\n\t\tz.array(z.lazy(() => json())),\n\t]) as unknown as JSONSchema;\n\nconst PackageSemVerSchema = z.string().superRefine((ver, context) => {\n\tconst validity = semverValid(ver);\n\n\tif (!validity) {\n\t\tcontext.addIssue({\n\t\t\tcode: 'custom',\n\t\t\tmessage: 'Invalid Semantic Version',\n\t\t\tinput: ver,\n\t\t});\n\t}\n});\n\n// matches @scope/name or name\nconst PackageNameSchema = z\n\t.string()\n\t.min(1)\n\t.max(214)\n\t.superRefine((name, context) => {\n\t\tif (isBuiltin(name)) {\n\t\t\tcontext.addIssue({\n\t\t\t\tcode: 'custom',\n\t\t\t\tmessage: 'Cannot use a built in node module name.',\n\t\t\t});\n\t\t}\n\n\t\tif (!/^(?:@[a-z0-9][a-z0-9._-]*\\/)?[a-z0-9][a-z0-9._-]*$/.test(name)) {\n\t\t\tcontext.addIssue({\n\t\t\t\tcode: 'custom',\n\t\t\t\tmessage: 'packages should  adhere to the npm package spec.',\n\t\t\t});\n\t\t}\n\t});\n\nconst ModuleTypeSchema = z.enum(['module', 'commonjs']);\n\n// Schema for RepositoryObject\nconst RepositoryObjectSchema = z.object({\n\ttype: z.string().optional(),\n\turl: z.string().optional(),\n\tdirectory: z.string().optional(),\n});\n\n// Schema for RepositoryField (string or RepositoryObject)\nexport const RepositoryFieldSchema = z.union([z.string(), RepositoryObjectSchema]);\n\n// Schema for BugsField\nexport const BugsFieldSchema = z.object({\n\turl: z.string().optional(),\n\temail: z.string().optional(),\n});\n\n// Schema for Person (string or object)\nconst PersonSchema = z.union([\n\tz.string(),\n\tz.object({\n\t\tname: z.string(),\n\t\temail: z.string().optional(),\n\t\turl: z.string().optional(),\n\t}),\n]);\n\n// Schema for DependenciesMap and similar record types\nconst DependenciesMapSchema = z.record(z.string(), z.string());\n\ntype ExportFieldType = string | ExportFieldMap;\n\ninterface ExportFieldMap {\n\t[key: string]: ExportFieldType | ExportFieldMap;\n}\n\n// Schema for complex nested ExportsField\nconst ExportsFieldSchema: z.ZodType<ExportFieldType> = z.lazy(() =>\n\tz.union([\n\t\tz.string(),\n\t\tz.record(z.string(), z.union([ExportsFieldSchema, z.record(z.string(), ExportsFieldSchema)])),\n\t]),\n);\n\n// Schema for WorkspacesField\nconst WorkspacesFieldSchema = z.union([\n\tz.array(z.string()),\n\tz.object({\n\t\tpackages: z.array(z.string()),\n\t\tnohoist: z.array(z.string()).optional(),\n\t}),\n]);\n\n// Main PackageJSON schema\nexport const PackageJSONSchema = z\n\t.object({\n\t\t// Identity\n\t\tname: PackageNameSchema,\n\t\tversion: PackageSemVerSchema.optional(),\n\t\tprivate: z.boolean().optional(),\n\t\ttype: ModuleTypeSchema.optional(),\n\n\t\t// Descriptive fields\n\t\tdescription: z.string().optional(),\n\t\tkeywords: z.array(z.string()).optional(),\n\t\thomepage: z.string().optional(),\n\t\trepository: RepositoryFieldSchema.optional(),\n\t\tbugs: BugsFieldSchema.optional(),\n\t\tlicense: z.string().optional(),\n\n\t\t// People\n\t\tauthor: PersonSchema.optional(),\n\t\tcontributors: z.array(PersonSchema).optional(),\n\t\tmaintainers: z.array(PersonSchema).optional(),\n\n\t\t// Entry points & files\n\t\tmain: z.string().optional(),\n\t\tmodule: z.string().optional(),\n\t\tbrowser: z.union([z.string(), z.record(z.string(), z.string())]).optional(),\n\t\ttypes: z.string().optional(),\n\t\ttypings: z.string().optional(),\n\t\tfiles: z.array(z.string()).optional(),\n\t\texports: z.union([ExportsFieldSchema, z.record(z.string(), ExportsFieldSchema)]).optional(),\n\t\tbin: z.union([z.string(), z.record(z.string(), z.string())]).optional(),\n\t\tman: z.union([z.string(), z.array(z.string())]).optional(),\n\n\t\t// Dependency fields\n\t\tdependencies: DependenciesMapSchema.optional(),\n\t\tdevDependencies: DependenciesMapSchema.optional(),\n\t\tpeerDependencies: DependenciesMapSchema.optional(),\n\t\toptionalDependencies: DependenciesMapSchema.optional(),\n\t\tbundledDependencies: z.array(z.string()).optional(),\n\t\tbundleDependencies: z.array(z.string()).optional(),\n\n\t\t// Workspaces / monorepo\n\t\tworkspaces: WorkspacesFieldSchema.optional(),\n\t})\n\t.catchall(json()); /** allow arbitrary JSON values. */\n\nexport type PackageJSON = z.infer<typeof PackageJSONSchema>;\n\nexport function isValidPackageJSON(o: unknown): o is PackageJSON {\n\treturn PackageJSONSchema.safeParse(o).success;\n}\n\n/**\n * Load a package.json for a package name or an absolute directory path.\n * - If `nameOrPath` is an absolute path, will load `<nameOrPath>/package.json`.\n * - Otherwise, will attempt to require `${nameOrPath}/package.json` using the project's\n *   createRequire helper so Node resolution rules and PnP work.\n * Returns `null` if the package.json could not be loaded.\n */\nexport function loadPackageJSON(nameOrPath: string): PackageJSON | null {\n\ttry {\n\t\tif (path.isAbsolute(nameOrPath)) {\n\t\t\tconst pkgPath = path.resolve(nameOrPath, './package.json');\n\t\t\tif (!fs.existsSync(pkgPath)) return null;\n\t\t\tconst raw = fs.readFileSync(pkgPath, { encoding: 'utf-8' });\n\t\t\treturn JSON.parse(raw) as PackageJSON;\n\t\t}\n\n\t\t// treat as package name and resolve via require\n\t\treturn require(`${nameOrPath}/package.json`) as PackageJSON;\n\t} catch {\n\t\treturn null;\n\t}\n}\n","import path from 'node:path';\nimport fg from 'fast-glob';\nimport fs from 'node:fs';\nimport { build, loadConfigFromFile, UserConfig } from 'vite';\nimport Logger from './logger';\nimport { loadPackageJSON, type PackageJSON } from './package';\n/**\n * Synchronously read a package.json for a given directory. Returns an empty object\n * when the package.json cannot be loaded so callers can treat it as optional.\n */\nfunction readPackageJSON(dir: string): PackageJSON {\n\treturn loadPackageJSON(dir) ?? ({} as PackageJSON);\n}\n\ninterface ViteMonoConfig {\n\troot: string;\n}\n\nasync function workspaceEntries(root: string, pkg: PackageJSON): Promise<[string, string][]> {\n\tconst workspacesField = pkg.workspaces;\n\tif (!workspacesField) return [];\n\n\t// resolve workspace globs to absolute directories\n\tconst workspaces = await fg(workspacesField as string | string[], {\n\t\tcwd: root,\n\t\tonlyDirectories: true,\n\t\tabsolute: true,\n\t});\n\n\t// map each workspace directory to its package name (if present)\n\treturn workspaces.map((workspacePath) => {\n\t\tconst workspacePkg = readPackageJSON(workspacePath);\n\t\treturn [workspacePkg.name ?? workspacePath, workspacePath] as [string, string];\n\t});\n}\n\nconst globFiles = (root: string, pattern: string | string[]) =>\n\tfg(pattern, {\n\t\tcwd: root,\n\t\tonlyFiles: true,\n\t\tbraceExpansion: true,\n\t\tglobstar: true,\n\t\tabsolute: true,\n\t});\n\nconst globFile = (...args: Parameters<typeof globFiles>) =>\n\tglobFiles(...args).then((entries) => entries[0] ?? null);\n\nconst messages = {\n\t'config-not-found':\n\t\t\"A Vite Config is required for workspace '%s' to be built. skipping workspace '%s' due to missing configuration...\",\n\t'config-resolution-error': \"An error occured while resolving a configuration for workspace '%s'.\",\n\t'source-resolution-error': \"Cannot resolve the source directory for '%s'.\",\n};\n\nconst logger = new Logger();\n\nfunction logf(format: string, ...params: string[]) {\n\tlogger.log(logger.format(format, ...(params as string[])));\n}\n\n// warnf intentionally omitted (not used).\n\ntype WorkspaceEntry = [string, string];\n\ninterface WorkspaceBindingAlias {\n\tname: string;\n\tsource: string;\n}\n\ninterface WorkspaceBinding {\n\talias: WorkspaceBindingAlias;\n}\n\ninterface Workspace {\n\tconfig: UserConfig;\n\tconfigFile: string;\n\tworkspaceBinding: WorkspaceBinding;\n\tsource: string;\n\troot: string;\n}\n\nclass ViteMono {\n\tpublic root: string;\n\tpublic package: Promise<PackageJSON>;\n\n\tconstructor(options: ViteMonoConfig) {\n\t\tconst root = path.resolve(process.cwd(), options.root);\n\t\tthis.root = root;\n\t\tthis.package = Promise.resolve(readPackageJSON(root));\n\t}\n\n\tasync getAllWorkspaceEntries() {\n\t\treturn workspaceEntries(this.root, await this.package);\n\t}\n\n\tasync getBuildConfiguration(\n\t\tworkspaceName: string,\n\t\tworkspaceAbsolutePath: string,\n\t): Promise<NonNullable<Awaited<ReturnType<typeof loadConfigFromFile>>> | null> {\n\t\tconst viteConfigPath = await globFile(\n\t\t\tworkspaceAbsolutePath,\n\t\t\t'vite.config.{cjs,mjs,js,cts,mts,ts}',\n\t\t);\n\n\t\tconsole.log(viteConfigPath);\n\n\t\tif (!viteConfigPath) {\n\t\t\tlogf(messages['config-not-found'], workspaceName, workspaceName);\n\t\t\treturn null;\n\t\t}\n\n\t\tconst configResolutionResult = await loadConfigFromFile(\n\t\t\t{\n\t\t\t\tcommand: 'build',\n\t\t\t\tmode: 'production',\n\t\t\t},\n\t\t\tviteConfigPath,\n\t\t\tworkspaceAbsolutePath,\n\t\t\t'silent',\n\t\t\tundefined,\n\t\t\t'runner',\n\t\t);\n\n\t\tif (!configResolutionResult) {\n\t\t\tlogf(messages['config-resolution-error'], workspaceName);\n\t\t\treturn null;\n\t\t}\n\n\t\treturn configResolutionResult;\n\t}\n\n\tasync getSourceDirectory(workspaceName: string, workspacePath: string) {\n\t\tlet source: string | null = null;\n\t\ttry {\n\t\t\tconst pkg = loadPackageJSON(workspacePath);\n\t\t\tif (pkg && typeof pkg.source === 'string' && pkg.source.length > 0) {\n\t\t\t\tsource = pkg.source;\n\t\t\t}\n\t\t} catch {\n\t\t\t// ignore package read errors and fallback to scanning dirs\n\t\t}\n\n\t\t// also test if source exists.\n\t\t// otherwise, fall on through popular\n\t\t// source directory names.\n\t\tconst popularNames = ['src', 'source', 'lib', 'lib/src'];\n\t\tconst candidates = source ? [source, ...popularNames] : popularNames;\n\t\tfor (const cand of candidates) {\n\t\t\tconst candPath = path.resolve(workspacePath, cand);\n\t\t\tif (fs.existsSync(candPath) && fs.statSync(candPath).isDirectory()) {\n\t\t\t\tsource = cand;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!source) {\n\t\t\tlogf(messages['source-resolution-error'], workspaceName);\n\t\t\treturn null;\n\t\t}\n\n\t\treturn source;\n\t}\n\n\tasync getAllWorkspaces(workspaceEntries: WorkspaceEntry[]): Promise<Workspace[]> {\n\t\tconst workspaces: (Workspace | null)[] = await Promise.all(\n\t\t\tworkspaceEntries.map(async ([workspaceName, workspacePath]) => {\n\t\t\t\tconst configResolutionResult = await this.getBuildConfiguration(\n\t\t\t\t\tworkspaceName,\n\t\t\t\t\tworkspacePath,\n\t\t\t\t);\n\n\t\t\t\tif (!configResolutionResult) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst { config, path: viteConfigPath } = configResolutionResult;\n\n\t\t\t\tconst source = await this.getSourceDirectory(workspaceName, workspacePath);\n\n\t\t\t\tif (!source) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst workspaceBindingAlias: WorkspaceBindingAlias = {\n\t\t\t\t\tname: workspaceName,\n\t\t\t\t\tsource: source,\n\t\t\t\t};\n\n\t\t\t\tconst workspaceBinding: WorkspaceBinding = {\n\t\t\t\t\talias: workspaceBindingAlias,\n\t\t\t\t};\n\n\t\t\t\treturn {\n\t\t\t\t\tconfig,\n\t\t\t\t\tworkspaceBinding,\n\t\t\t\t\tsource,\n\t\t\t\t\troot: workspacePath,\n\t\t\t\t\tconfigFile: viteConfigPath,\n\t\t\t\t};\n\t\t\t}),\n\t\t);\n\n\t\t// could have used Boolean but typescript is not\n\t\t// happy with that.\n\t\treturn workspaces.filter((w) => w !== null);\n\t}\n\n\t// returns a set of workspace binding aliases as a map\n\t// to be used for vite config.\n\tgetWorkspaceBindingAliasMap(workspaces: Workspace[]) {\n\t\treturn Object.fromEntries(\n\t\t\tworkspaces.map((ws) => [ws.workspaceBinding.alias.name, ws.workspaceBinding.alias.source]),\n\t\t);\n\t}\n\n\tfinalAliasMapFor(workspace: Workspace, bindingAliasMap: Record<string, string>) {\n\t\tconst clone = { ...bindingAliasMap };\n\n\t\tdelete clone[workspace.workspaceBinding.alias.name];\n\n\t\treturn clone;\n\t}\n\n\tasync build() {\n\t\ttry {\n\t\t\tconst workspaceEntries = await this.getAllWorkspaceEntries();\n\n\t\t\t// a set to track workspaces.\n\t\t\t// prepare alias map for workspace packages so builds can resolve local packages to their src\n\t\t\tconst workspaces = await this.getAllWorkspaces(workspaceEntries);\n\t\t\tconst workspaceBindingAliasMap = this.getWorkspaceBindingAliasMap(workspaces);\n\n\t\t\tfor (const workspace of workspaces) {\n\t\t\t\tconst mergedResolve = {\n\t\t\t\t\t...(workspace.config.resolve ?? {}),\n\t\t\t\t\talias: {\n\t\t\t\t\t\t...(workspace.config.resolve?.alias ?? {}),\n\t\t\t\t\t\t...this.finalAliasMapFor(workspace, workspaceBindingAliasMap),\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tawait build({\n\t\t\t\t\t...workspace.config,\n\t\t\t\t\troot: workspace.root,\n\t\t\t\t\tresolve: mergedResolve,\n\t\t\t\t\tforceOptimizeDeps: true,\n\t\t\t\t\tconfigFile: workspace.configFile,\n\t\t\t\t\tlogLevel: 'silent',\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlogger.error(String(e));\n\t\t}\n\t}\n}\n\nexport { ViteMono };\nexport type { ViteMonoConfig };\n","import yargs from 'yargs';\nimport { hideBin } from 'yargs/helpers';\nimport { ViteMono, ViteMonoConfig } from '.';\nimport require from './require';\nimport path from 'node:path';\nimport { pathToFileURL } from 'node:url';\n\nasync function bootstrap() {\n\tconst args = await yargs(hideBin(process.argv))\n\t\t.option('config', {\n\t\t\talias: 'c',\n\t\t\ttype: 'string',\n\t\t\tdefault: 'vite-mono.config.js',\n\t\t\tdescription: 'Path to config file',\n\t\t})\n\t\t.parseAsync();\n\n\t// current working directory\n\tconst cwd = process.cwd();\n\n\t// the actual config path relative to the current working\n\t// directory.\n\tconst configPath = args.config || 'vite-mono.config.js';\n\n\t// resolve the actual path.\n\tconst vmConfigPath = path.resolve(cwd, configPath);\n\n\t// load config - support both CommonJS (require) and ESM (dynamic import)\n\tlet vmConfig: ViteMonoConfig | undefined;\n\ttry {\n\t\t// attempt to require (works for CJS and some transpiled modules)\n\t\tconst loaded = require(vmConfigPath);\n\t\tvmConfig = loaded && loaded.__esModule && loaded.default ? loaded.default : loaded;\n\t} catch {\n\t\t// fallback to dynamic import for ESM configs\n\t\tconst fileUrl = pathToFileURL(vmConfigPath).href;\n\t\tconst imported = await import(fileUrl);\n\t\tvmConfig = imported.default ?? imported;\n\t}\n\n\tif (!vmConfig || typeof vmConfig.root !== 'string') {\n\t\tthrow new TypeError(\n\t\t\t`Invalid ViteMono config loaded from ${vmConfigPath}. Expected an object with a string 'root' property.`,\n\t\t);\n\t}\n\n\tconst vm = new ViteMono(vmConfig as ViteMonoConfig);\n\n\t// build\n\tawait vm.build();\n}\n\nbootstrap().catch(console.error);\n"],"names":["format","sprintf","require","workspaceEntries"],"mappings":"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"}