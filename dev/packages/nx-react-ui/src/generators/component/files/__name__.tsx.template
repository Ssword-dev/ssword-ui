<%
const typeImports = [forward && 'RefType', 'Props', 'ClassProps', asChild && 'AsChildProps', variants && 'VariantProps'].filter(Boolean);
const propTypeBases = ['Props<ComponentBase>', 'ClassProps', asChild && 'AsChildProps', variants && `VariantProps<${componentName}VM>`].filter(Boolean);
const reactImports = [forward && 'forwardRef'];

function conditionalImports(){
  return lines(
    'import { Slot } from \'@radix-ui/react-slot\';',
    `import { ${
        [
          'cn', 
          variants && 'cvm'
        ]
      .filter(Boolean).join(', ')
      } } from '@ssword/utils-dom';`
  );
}

function componentConfiguration(){
  return lines(
    'const base = \'div\';',
    '',
    'type ComponentBase = typeof base';
    '',
    ...(variants ? [
      `const ${componentName}VM = cvm(\'\', {`,
      '\tvariants: {},',
      '\tdefaultVariants: {},',
      '\tcompoundVariants: []',
      '});'
    ] : []),
  );
}

function componentPropsInterface(){
  return `interface ${componentExportName}Props extends ${propTypeBases.join(', ')} {}`
}

function renderFunction(){
  return lines(
  '(',
  '{',
  asChild ? 'asChild = false,' : '',
  'className,',
  '...props',
  '}:',
  `${componentExportName}Props,`,
  forward ? 'forwardedRef' : '',
  ') => {',
  'const Comp = ${asChild ? 'asChild ? Slot : base' : 'base'};',
  'const { className, ...restProps } = props;',
  'return (',
  '<Comp',
  {...restProps}',
  forward && 'ref={forwardRef}',
  'className={',
  'cn(className)',
  '}',
  '>',
  '{props.children}',
  '</Comp>',
  ');',
  '}',
  )
}
%>
'use client';

import React, { <% if (forward) { %>forwardRef<% } %> } from 'react';

<%- conditionalImports() %>

import type { <%= typeImports.join(', ') %> } from './types.ts';

<%- componentConfiguration() %>

<%- componentPropsInterface() %>

const <%= componentExportName %> =
  <% if (forward) { %>forwardRef<RefType<ComponentBase>, <%= componentName %>Props>(<% } %>()<% if (forward) { %>)<% } %>;

export default <%= componentExportName %>;
